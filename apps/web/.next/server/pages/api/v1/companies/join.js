"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/v1/companies/join";
exports.ids = ["pages/api/v1/companies/join"];
exports.modules = {

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "pg":
/*!*********************!*\
  !*** external "pg" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("pg");

/***/ }),

/***/ "bcryptjs":
/*!***************************!*\
  !*** external "bcryptjs" ***!
  \***************************/
/***/ ((module) => {

module.exports = import("bcryptjs");;

/***/ }),

/***/ "(api)/../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fv1%2Fcompanies%2Fjoin&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fv1%2Fcompanies%2Fjoin.js&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fv1%2Fcompanies%2Fjoin&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fv1%2Fcompanies%2Fjoin.js&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/../../node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/../../node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/../../node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_v1_companies_join_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/pages/api/v1/companies/join.js */ \"(api)/./src/pages/api/v1/companies/join.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_v1_companies_join_js__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_v1_companies_join_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_v1_companies_join_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_v1_companies_join_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/v1/companies/join\",\n        pathname: \"/api/v1/companies/join\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_v1_companies_join_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi4vLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1yb3V0ZS1sb2FkZXIvaW5kZXguanM/a2luZD1QQUdFU19BUEkmcGFnZT0lMkZhcGklMkZ2MSUyRmNvbXBhbmllcyUyRmpvaW4mcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZzcmMlMkZwYWdlcyUyRmFwaSUyRnYxJTJGY29tcGFuaWVzJTJGam9pbi5qcyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNpRTtBQUNqRTtBQUNBLGlFQUFlLHdFQUFLLENBQUMsZ0VBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLGdFQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL3dlYi8/YWU1ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vc3JjL3BhZ2VzL2FwaS92MS9jb21wYW5pZXMvam9pbi5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3YxL2NvbXBhbmllcy9qb2luXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvdjEvY29tcGFuaWVzL2pvaW5cIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fv1%2Fcompanies%2Fjoin&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fv1%2Fcompanies%2Fjoin.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/pages/api/v1/companies/join.js":
/*!********************************************!*\
  !*** ./src/pages/api/v1/companies/join.js ***!
  \********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! pg */ \"pg\");\n/* harmony import */ var pg__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(pg__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! bcryptjs */ \"bcryptjs\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([bcryptjs__WEBPACK_IMPORTED_MODULE_2__]);\nbcryptjs__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// pages/api/v1/companies/join.js\n\n\n\nconst pool = new pg__WEBPACK_IMPORTED_MODULE_0__.Pool({\n    connectionString: process.env.DATABASE_URL\n});\nconst JWT_SECRET = process.env.JWT_SECRET || \"dev_secret_change_me\";\nconst isDev = \"development\" !== \"production\";\nfunction tokenFromCookie(req) {\n    const cookie = req.headers.cookie || \"\";\n    const p = cookie.split(\"; \").find((c)=>c.startsWith(\"gidkit_token=\"));\n    return p ? decodeURIComponent(p.split(\"=\")[1]) : null;\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        res.setHeader(\"Allow\", [\n            \"POST\"\n        ]);\n        return res.status(405).json({\n            message: \"Method not allowed\"\n        });\n    }\n    const token = tokenFromCookie(req);\n    if (!token) {\n        return res.status(401).json({\n            message: \"Не авторизован\"\n        });\n    }\n    let auth;\n    try {\n        auth = jsonwebtoken__WEBPACK_IMPORTED_MODULE_1___default().verify(token, JWT_SECRET);\n    } catch (e) {\n        if (isDev) console.error(\"join companies: jwt error\", e);\n        return res.status(401).json({\n            message: \"Не авторизован\"\n        });\n    }\n    const { login, password } = req.body || {};\n    if (!login || !password) {\n        return res.status(400).json({\n            message: \"Нужно указать логин и пароль\"\n        });\n    }\n    const client = await pool.connect();\n    try {\n        await client.query(\"BEGIN\");\n        // ищем НЕИСПОЛЬЗОВАННОЕ приглашение\n        const { rows: inviteRows } = await client.query(`SELECT ci.*, c.name AS company_name, c.logo_url\n       FROM company_invites ci\n       JOIN companies c ON c.id = ci.company_id\n       WHERE ci.login = $1\n         AND (ci.is_used IS NOT TRUE)\n       ORDER BY ci.created_at DESC\n       LIMIT 1`, [\n            login\n        ]);\n        if (!inviteRows[0]) {\n            await client.query(\"ROLLBACK\");\n            return res.status(404).json({\n                message: \"Такой пользователь не найден\"\n            });\n        }\n        const invite = inviteRows[0];\n        const ok = await bcryptjs__WEBPACK_IMPORTED_MODULE_2__[\"default\"].compare(password, invite.password_hash);\n        if (!ok) {\n            await client.query(\"ROLLBACK\");\n            return res.status(401).json({\n                message: \"Такой пользователь не найден\"\n            });\n        }\n        // добавляем роль текущему пользователю\n        const { rows: ucrCols } = await client.query(`SELECT column_name\n       FROM information_schema.columns\n       WHERE table_name = 'user_company_roles'`);\n        const colNames = ucrCols.map((r)=>r.column_name);\n        const hasRole = colNames.includes(\"role\");\n        const hasInvitedBy = colNames.includes(\"invited_by\");\n        const hasInvitedAt = colNames.includes(\"invited_at\");\n        // есть ли уже запись\n        const { rows: existing } = await client.query(`SELECT id, role\n       FROM user_company_roles\n       WHERE user_id = $1 AND company_id = $2\n       LIMIT 1`, [\n            auth.sub,\n            invite.company_id\n        ]);\n        if (!existing[0]) {\n            // вставляем новую\n            const cols = [\n                \"user_id\",\n                \"company_id\"\n            ];\n            const vals = [\n                auth.sub,\n                invite.company_id\n            ];\n            const placeholders = [\n                \"$1\",\n                \"$2\"\n            ];\n            let i = 3;\n            if (hasRole) {\n                cols.push(\"role\");\n                vals.push(invite.role);\n                placeholders.push(`$${i++}`);\n            }\n            if (hasInvitedBy) {\n                cols.push(\"invited_by\");\n                vals.push(invite.created_by || null);\n                placeholders.push(`$${i++}`);\n            }\n            if (hasInvitedAt) {\n                cols.push(\"invited_at\");\n                vals.push(new Date());\n                placeholders.push(`$${i++}`);\n            }\n            const sql = `\n        INSERT INTO user_company_roles (${cols.join(\", \")})\n        VALUES (${placeholders.join(\", \")})\n      `;\n            await client.query(sql, vals);\n        } else if (hasRole) {\n            // обновляем роль, если таблица поддерживает role\n            await client.query(`UPDATE user_company_roles\n         SET role = $3\n         WHERE user_id = $1 AND company_id = $2`, [\n                auth.sub,\n                invite.company_id,\n                invite.role\n            ]);\n        }\n        // помечаем приглашение как ИСПОЛЬЗОВАННОЕ (одноразовое)\n        const hasUsed = (await client.query(`SELECT column_name\n       FROM information_schema.columns\n       WHERE table_name = 'company_invites' AND column_name = 'is_used'`)).rowCount > 0;\n        const hasUsedBy = (await client.query(`SELECT column_name\n       FROM information_schema.columns\n       WHERE table_name = 'company_invites' AND column_name = 'used_by'`)).rowCount > 0;\n        const hasUsedAt = (await client.query(`SELECT column_name\n       FROM information_schema.columns\n       WHERE table_name = 'company_invites' AND column_name = 'used_at'`)).rowCount > 0;\n        const updCols = [];\n        const updVals = [];\n        let j = 1;\n        if (hasUsed) {\n            updCols.push(`is_used = $${j++}`);\n            updVals.push(true);\n        }\n        if (hasUsedBy) {\n            updCols.push(`used_by = $${j++}`);\n            updVals.push(auth.sub);\n        }\n        if (hasUsedAt) {\n            updCols.push(`used_at = $${j++}`);\n            updVals.push(new Date());\n        }\n        if (updCols.length > 0) {\n            updVals.push(invite.id);\n            const sql = `\n        UPDATE company_invites\n        SET ${updCols.join(\", \")}\n        WHERE id = $${updVals.length}\n      `;\n            await client.query(sql, updVals);\n        }\n        // перечитываем список компаний текущего пользователя\n        const { rows: companies } = await client.query(`SELECT c.id, c.name, c.logo_url\n       FROM companies c\n       JOIN user_company_roles ucr ON ucr.company_id = c.id\n       WHERE ucr.user_id = $1\n       ORDER BY c.name ASC`, [\n            auth.sub\n        ]);\n        await client.query(\"COMMIT\");\n        return res.status(200).json({\n            ok: true,\n            companies,\n            joined_company_id: invite.company_id\n        });\n    } catch (e) {\n        await client.query(\"ROLLBACK\");\n        if (isDev) console.error(\"join companies error\", e);\n        return res.status(500).json({\n            message: isDev ? `Ошибка сервера: ${e.message}` : \"Ошибка сервера\"\n        });\n    } finally{\n        client.release();\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL3YxL2NvbXBhbmllcy9qb2luLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLGlDQUFpQztBQUNQO0FBQ0s7QUFDRDtBQUU5QixNQUFNRyxPQUFPLElBQUlILG9DQUFJQSxDQUFDO0lBQUVJLGtCQUFrQkMsUUFBUUMsR0FBRyxDQUFDQyxZQUFZO0FBQUM7QUFDbkUsTUFBTUMsYUFBYUgsUUFBUUMsR0FBRyxDQUFDRSxVQUFVLElBQUk7QUFDN0MsTUFBTUMsUUFBUUosa0JBQXlCO0FBRXZDLFNBQVNLLGdCQUFnQkMsR0FBRztJQUMxQixNQUFNQyxTQUFTRCxJQUFJRSxPQUFPLENBQUNELE1BQU0sSUFBSTtJQUNyQyxNQUFNRSxJQUFJRixPQUFPRyxLQUFLLENBQUMsTUFBTUMsSUFBSSxDQUFDQyxDQUFBQSxJQUFLQSxFQUFFQyxVQUFVLENBQUM7SUFDcEQsT0FBT0osSUFBSUssbUJBQW1CTCxFQUFFQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsSUFBSTtBQUNuRDtBQUVlLGVBQWVLLFFBQVFULEdBQUcsRUFBRVUsR0FBRztJQUM1QyxJQUFJVixJQUFJVyxNQUFNLEtBQUssUUFBUTtRQUN6QkQsSUFBSUUsU0FBUyxDQUFDLFNBQVM7WUFBQztTQUFPO1FBQy9CLE9BQU9GLElBQUlHLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsU0FBUztRQUFxQjtJQUM5RDtJQUVBLE1BQU1DLFFBQVFqQixnQkFBZ0JDO0lBQzlCLElBQUksQ0FBQ2dCLE9BQU87UUFDVixPQUFPTixJQUFJRyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLFNBQVM7UUFBaUI7SUFDMUQ7SUFFQSxJQUFJRTtJQUNKLElBQUk7UUFDRkEsT0FBTzNCLDBEQUFVLENBQUMwQixPQUFPbkI7SUFDM0IsRUFBRSxPQUFPc0IsR0FBRztRQUNWLElBQUlyQixPQUFPc0IsUUFBUUMsS0FBSyxDQUFDLDZCQUE2QkY7UUFDdEQsT0FBT1QsSUFB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QUFFO1lBQ3RCLE1BQU1WLE1BQU0sQ0FBQzs7WUFFUCxFQUFFTSxRQUFRTCxJQUFJLENBQUMsTUFBTTtvQkFDYixFQUFFTSxRQUFRRSxNQUFNLENBQUM7TUFDL0IsQ0FBQztZQUNELE1BQU10QyxPQUFPRSxLQUFLLENBQUMyQixLQUFLTztRQUMxQjtRQUVBLHFEQUFxRDtRQUNyRCxNQUFNLEVBQUVqQyxNQUFNcUMsU0FBUyxFQUFFLEdBQUcsTUFBTXhDLE9BQU9FLEtBQUssQ0FDNUMsQ0FBQzs7OzswQkFJbUIsQ0FBQyxFQUNyQjtZQUFDVixLQUFLMkIsR0FBRztTQUFDO1FBR1osTUFBTW5CLE9BQU9FLEtBQUssQ0FBQztRQUVuQixPQUFPakIsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQmlCLElBQUk7WUFDSmtDO1lBQ0FDLG1CQUFtQnBDLE9BQU9lLFVBQVU7UUFDdEM7SUFDRixFQUFFLE9BQU8xQixHQUFHO1FBQ1YsTUFBTU0sT0FBT0UsS0FBSyxDQUFDO1FBQ25CLElBQUk3QixPQUFPc0IsUUFBUUMsS0FBSyxDQUFDLHdCQUF3QkY7UUFDakQsT0FBT1QsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQkMsU0FBU2pCLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRXFCLEVBQUVKLE9BQU8sQ0FBQyxDQUFDLEdBQUc7UUFDcEQ7SUFDRixTQUFVO1FBQ1JVLE9BQU8wQyxPQUFPO0lBQ2hCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly93ZWIvLi9zcmMvcGFnZXMvYXBpL3YxL2NvbXBhbmllcy9qb2luLmpzP2RhM2IiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gcGFnZXMvYXBpL3YxL2NvbXBhbmllcy9qb2luLmpzXG5pbXBvcnQgeyBQb29sIH0gZnJvbSAncGcnO1xuaW1wb3J0IGp3dCBmcm9tICdqc29ud2VidG9rZW4nO1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5cbmNvbnN0IHBvb2wgPSBuZXcgUG9vbCh7IGNvbm5lY3Rpb25TdHJpbmc6IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB9KTtcbmNvbnN0IEpXVF9TRUNSRVQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICdkZXZfc2VjcmV0X2NoYW5nZV9tZSc7XG5jb25zdCBpc0RldiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbic7XG5cbmZ1bmN0aW9uIHRva2VuRnJvbUNvb2tpZShyZXEpIHtcbiAgY29uc3QgY29va2llID0gcmVxLmhlYWRlcnMuY29va2llIHx8ICcnO1xuICBjb25zdCBwID0gY29va2llLnNwbGl0KCc7ICcpLmZpbmQoYyA9PiBjLnN0YXJ0c1dpdGgoJ2dpZGtpdF90b2tlbj0nKSk7XG4gIHJldHVybiBwID8gZGVjb2RlVVJJQ29tcG9uZW50KHAuc3BsaXQoJz0nKVsxXSkgOiBudWxsO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGlmIChyZXEubWV0aG9kICE9PSAnUE9TVCcpIHtcbiAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnUE9TVCddKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDUpLmpzb24oeyBtZXNzYWdlOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbiAgfVxuXG4gIGNvbnN0IHRva2VuID0gdG9rZW5Gcm9tQ29va2llKHJlcSk7XG4gIGlmICghdG9rZW4pIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAn0J3QtSDQsNCy0YLQvtGA0LjQt9C+0LLQsNC9JyB9KTtcbiAgfVxuXG4gIGxldCBhdXRoO1xuICB0cnkge1xuICAgIGF1dGggPSBqd3QudmVyaWZ5KHRva2VuLCBKV1RfU0VDUkVUKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmIChpc0RldikgY29uc29sZS5lcnJvcignam9pbiBjb21wYW5pZXM6IGp3dCBlcnJvcicsIGUpO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICfQndC1INCw0LLRgtC+0YDQuNC30L7QstCw0L0nIH0pO1xuICB9XG5cbiAgY29uc3QgeyBsb2dpbiwgcGFzc3dvcmQgfSA9IHJlcS5ib2R5IHx8IHt9O1xuICBpZiAoIWxvZ2luIHx8ICFwYXNzd29yZCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICfQndGD0LbQvdC+INGD0LrQsNC30LDRgtGMINC70L7Qs9C40L0g0Lgg0L/QsNGA0L7Qu9GMJyB9KTtcbiAgfVxuXG4gIGNvbnN0IGNsaWVudCA9IGF3YWl0IHBvb2wuY29ubmVjdCgpO1xuICB0cnkge1xuICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnQkVHSU4nKTtcblxuICAgIC8vINC40YnQtdC8INCd0JXQmNCh0J/QntCb0KzQl9Ce0JLQkNCd0J3QntCVINC/0YDQuNCz0LvQsNGI0LXQvdC40LVcbiAgICBjb25zdCB7IHJvd3M6IGludml0ZVJvd3MgfSA9IGF3YWl0IGNsaWVudC5xdWVyeShcbiAgICAgIGBTRUxFQ1QgY2kuKiwgYy5uYW1lIEFTIGNvbXBhbnlfbmFtZSwgYy5sb2dvX3VybFxuICAgICAgIEZST00gY29tcGFueV9pbnZpdGVzIGNpXG4gICAgICAgSk9JTiBjb21wYW5pZXMgYyBPTiBjLmlkID0gY2kuY29tcGFueV9pZFxuICAgICAgIFdIRVJFIGNpLmxvZ2luID0gJDFcbiAgICAgICAgIEFORCAoY2kuaXNfdXNlZCBJUyBOT1QgVFJVRSlcbiAgICAgICBPUkRFUiBCWSBjaS5jcmVhdGVkX2F0IERFU0NcbiAgICAgICBMSU1JVCAxYCxcbiAgICAgIFtsb2dpbl0sXG4gICAgKTtcblxuICAgIGlmICghaW52aXRlUm93c1swXSkge1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdST0xMQkFDSycpO1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ9Ci0LDQutC+0Lkg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GMINC90LUg0L3QsNC50LTQtdC9JyB9KTtcbiAgICB9XG5cbiAgICBjb25zdCBpbnZpdGUgPSBpbnZpdGVSb3dzWzBdO1xuXG4gICAgY29uc3Qgb2sgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgaW52aXRlLnBhc3N3b3JkX2hhc2gpO1xuICAgIGlmICghb2spIHtcbiAgICAgIGF3YWl0IGNsaWVudC5xdWVyeSgnUk9MTEJBQ0snKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICfQotCw0LrQvtC5INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCDQvdC1INC90LDQudC00LXQvScgfSk7XG4gICAgfVxuXG4gICAgLy8g0LTQvtCx0LDQstC70Y/QtdC8INGA0L7Qu9GMINGC0LXQutGD0YnQtdC80YMg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GOXG4gICAgY29uc3QgeyByb3dzOiB1Y3JDb2xzIH0gPSBhd2FpdCBjbGllbnQucXVlcnkoXG4gICAgICBgU0VMRUNUIGNvbHVtbl9uYW1lXG4gICAgICAgRlJPTSBpbmZvcm1hdGlvbl9zY2hlbWEuY29sdW1uc1xuICAgICAgIFdIRVJFIHRhYmxlX25hbWUgPSAndXNlcl9jb21wYW55X3JvbGVzJ2AsXG4gICAgKTtcbiAgICBjb25zdCBjb2xOYW1lcyA9IHVjckNvbHMubWFwKHIgPT4gci5jb2x1bW5fbmFtZSk7XG4gICAgY29uc3QgaGFzUm9sZSA9IGNvbE5hbWVzLmluY2x1ZGVzKCdyb2xlJyk7XG4gICAgY29uc3QgaGFzSW52aXRlZEJ5ID0gY29sTmFtZXMuaW5jbHVkZXMoJ2ludml0ZWRfYnknKTtcbiAgICBjb25zdCBoYXNJbnZpdGVkQXQgPSBjb2xOYW1lcy5pbmNsdWRlcygnaW52aXRlZF9hdCcpO1xuXG4gICAgLy8g0LXRgdGC0Ywg0LvQuCDRg9C20LUg0LfQsNC/0LjRgdGMXG4gICAgY29uc3QgeyByb3dzOiBleGlzdGluZyB9ID0gYXdhaXQgY2xpZW50LnF1ZXJ5KFxuICAgICAgYFNFTEVDVCBpZCwgcm9sZVxuICAgICAgIEZST00gdXNlcl9jb21wYW55X3JvbGVzXG4gICAgICAgV0hFUkUgdXNlcl9pZCA9ICQxIEFORCBjb21wYW55X2lkID0gJDJcbiAgICAgICBMSU1JVCAxYCxcbiAgICAgIFthdXRoLnN1YiwgaW52aXRlLmNvbXBhbnlfaWRdLFxuICAgICk7XG5cbiAgICBpZiAoIWV4aXN0aW5nWzBdKSB7XG4gICAgICAvLyDQstGB0YLQsNCy0LvRj9C10Lwg0L3QvtCy0YPRjlxuICAgICAgY29uc3QgY29scyA9IFsndXNlcl9pZCcsICdjb21wYW55X2lkJ107XG4gICAgICBjb25zdCB2YWxzID0gW2F1dGguc3ViLCBpbnZpdGUuY29tcGFueV9pZF07XG4gICAgICBjb25zdCBwbGFjZWhvbGRlcnMgPSBbJyQxJywgJyQyJ107XG4gICAgICBsZXQgaSA9IDM7XG5cbiAgICAgIGlmIChoYXNSb2xlKSB7XG4gICAgICAgIGNvbHMucHVzaCgncm9sZScpO1xuICAgICAgICB2YWxzLnB1c2goaW52aXRlLnJvbGUpO1xuICAgICAgICBwbGFjZWhvbGRlcnMucHVzaChgJCR7aSsrfWApO1xuICAgICAgfVxuICAgICAgaWYgKGhhc0ludml0ZWRCeSkge1xuICAgICAgICBjb2xzLnB1c2goJ2ludml0ZWRfYnknKTtcbiAgICAgICAgdmFscy5wdXNoKGludml0ZS5jcmVhdGVkX2J5IHx8IG51bGwpO1xuICAgICAgICBwbGFjZWhvbGRlcnMucHVzaChgJCR7aSsrfWApO1xuICAgICAgfVxuICAgICAgaWYgKGhhc0ludml0ZWRBdCkge1xuICAgICAgICBjb2xzLnB1c2goJ2ludml0ZWRfYXQnKTtcbiAgICAgICAgdmFscy5wdXNoKG5ldyBEYXRlKCkpO1xuICAgICAgICBwbGFjZWhvbGRlcnMucHVzaChgJCR7aSsrfWApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzcWwgPSBgXG4gICAgICAgIElOU0VSVCBJTlRPIHVzZXJfY29tcGFueV9yb2xlcyAoJHtjb2xzLmpvaW4oJywgJyl9KVxuICAgICAgICBWQUxVRVMgKCR7cGxhY2Vob2xkZXJzLmpvaW4oJywgJyl9KVxuICAgICAgYDtcbiAgICAgIGF3YWl0IGNsaWVudC5xdWVyeShzcWwsIHZhbHMpO1xuICAgIH0gZWxzZSBpZiAoaGFzUm9sZSkge1xuICAgICAgLy8g0L7QsdC90L7QstC70Y/QtdC8INGA0L7Qu9GMLCDQtdGB0LvQuCDRgtCw0LHQu9C40YbQsCDQv9C+0LTQtNC10YDQttC40LLQsNC10YIgcm9sZVxuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KFxuICAgICAgICBgVVBEQVRFIHVzZXJfY29tcGFueV9yb2xlc1xuICAgICAgICAgU0VUIHJvbGUgPSAkM1xuICAgICAgICAgV0hFUkUgdXNlcl9pZCA9ICQxIEFORCBjb21wYW55X2lkID0gJDJgLFxuICAgICAgICBbYXV0aC5zdWIsIGludml0ZS5jb21wYW55X2lkLCBpbnZpdGUucm9sZV0sXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vINC/0L7QvNC10YfQsNC10Lwg0L/RgNC40LPQu9Cw0YjQtdC90LjQtSDQutCw0Log0JjQodCf0J7Qm9Cs0JfQntCS0JDQndCd0J7QlSAo0L7QtNC90L7RgNCw0LfQvtCy0L7QtSlcbiAgICBjb25zdCBoYXNVc2VkID0gKGF3YWl0IGNsaWVudC5xdWVyeShcbiAgICAgIGBTRUxFQ1QgY29sdW1uX25hbWVcbiAgICAgICBGUk9NIGluZm9ybWF0aW9uX3NjaGVtYS5jb2x1bW5zXG4gICAgICAgV0hFUkUgdGFibGVfbmFtZSA9ICdjb21wYW55X2ludml0ZXMnIEFORCBjb2x1bW5fbmFtZSA9ICdpc191c2VkJ2AsXG4gICAgKSkucm93Q291bnQgPiAwO1xuICAgIGNvbnN0IGhhc1VzZWRCeSA9IChhd2FpdCBjbGllbnQucXVlcnkoXG4gICAgICBgU0VMRUNUIGNvbHVtbl9uYW1lXG4gICAgICAgRlJPTSBpbmZvcm1hdGlvbl9zY2hlbWEuY29sdW1uc1xuICAgICAgIFdIRVJFIHRhYmxlX25hbWUgPSAnY29tcGFueV9pbnZpdGVzJyBBTkQgY29sdW1uX25hbWUgPSAndXNlZF9ieSdgLFxuICAgICkpLnJvd0NvdW50ID4gMDtcbiAgICBjb25zdCBoYXNVc2VkQXQgPSAoYXdhaXQgY2xpZW50LnF1ZXJ5KFxuICAgICAgYFNFTEVDVCBjb2x1bW5fbmFtZVxuICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnNcbiAgICAgICBXSEVSRSB0YWJsZV9uYW1lID0gJ2NvbXBhbnlfaW52aXRlcycgQU5EIGNvbHVtbl9uYW1lID0gJ3VzZWRfYXQnYCxcbiAgICApKS5yb3dDb3VudCA+IDA7XG5cbiAgICBjb25zdCB1cGRDb2xzID0gW107XG4gICAgY29uc3QgdXBkVmFscyA9IFtdO1xuICAgIGxldCBqID0gMTtcblxuICAgIGlmIChoYXNVc2VkKSB7XG4gICAgICB1cGRDb2xzLnB1c2goYGlzX3VzZWQgPSAkJHtqKyt9YCk7XG4gICAgICB1cGRWYWxzLnB1c2godHJ1ZSk7XG4gICAgfVxuICAgIGlmIChoYXNVc2VkQnkpIHtcbiAgICAgIHVwZENvbHMucHVzaChgdXNlZF9ieSA9ICQke2orK31gKTtcbiAgICAgIHVwZFZhbHMucHVzaChhdXRoLnN1Yik7XG4gICAgfVxuICAgIGlmIChoYXNVc2VkQXQpIHtcbiAgICAgIHVwZENvbHMucHVzaChgdXNlZF9hdCA9ICQke2orK31gKTtcbiAgICAgIHVwZFZhbHMucHVzaChuZXcgRGF0ZSgpKTtcbiAgICB9XG5cbiAgICBpZiAodXBkQ29scy5sZW5ndGggPiAwKSB7XG4gICAgICB1cGRWYWxzLnB1c2goaW52aXRlLmlkKTtcbiAgICAgIGNvbnN0IHNxbCA9IGBcbiAgICAgICAgVVBEQVRFIGNvbXBhbnlfaW52aXRlc1xuICAgICAgICBTRVQgJHt1cGRDb2xzLmpvaW4oJywgJyl9XG4gICAgICAgIFdIRVJFIGlkID0gJCR7dXBkVmFscy5sZW5ndGh9XG4gICAgICBgO1xuICAgICAgYXdhaXQgY2xpZW50LnF1ZXJ5KHNxbCwgdXBkVmFscyk7XG4gICAgfVxuXG4gICAgLy8g0L/QtdGA0LXRh9C40YLRi9Cy0LDQtdC8INGB0L/QuNGB0L7QuiDQutC+0LzQv9Cw0L3QuNC5INGC0LXQutGD0YnQtdCz0L4g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPXG4gICAgY29uc3QgeyByb3dzOiBjb21wYW5pZXMgfSA9IGF3YWl0IGNsaWVudC5xdWVyeShcbiAgICAgIGBTRUxFQ1QgYy5pZCwgYy5uYW1lLCBjLmxvZ29fdXJsXG4gICAgICAgRlJPTSBjb21wYW5pZXMgY1xuICAgICAgIEpPSU4gdXNlcl9jb21wYW55X3JvbGVzIHVjciBPTiB1Y3IuY29tcGFueV9pZCA9IGMuaWRcbiAgICAgICBXSEVSRSB1Y3IudXNlcl9pZCA9ICQxXG4gICAgICAgT1JERVIgQlkgYy5uYW1lIEFTQ2AsXG4gICAgICBbYXV0aC5zdWJdLFxuICAgICk7XG5cbiAgICBhd2FpdCBjbGllbnQucXVlcnkoJ0NPTU1JVCcpO1xuXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIG9rOiB0cnVlLFxuICAgICAgY29tcGFuaWVzLFxuICAgICAgam9pbmVkX2NvbXBhbnlfaWQ6IGludml0ZS5jb21wYW55X2lkLFxuICAgIH0pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgYXdhaXQgY2xpZW50LnF1ZXJ5KCdST0xMQkFDSycpO1xuICAgIGlmIChpc0RldikgY29uc29sZS5lcnJvcignam9pbiBjb21wYW5pZXMgZXJyb3InLCBlKTtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgbWVzc2FnZTogaXNEZXYgPyBg0J7RiNC40LHQutCwINGB0LXRgNCy0LXRgNCwOiAke2UubWVzc2FnZX1gIDogJ9Ce0YjQuNCx0LrQsCDRgdC10YDQstC10YDQsCcsXG4gICAgfSk7XG4gIH0gZmluYWxseSB7XG4gICAgY2xpZW50LnJlbGVhc2UoKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlBvb2wiLCJqd3QiLCJiY3J5cHQiLCJwb29sIiwiY29ubmVjdGlvblN0cmluZyIsInByb2Nlc3MiLCJlbnYiLCJEQVRBQkFTRV9VUkwiLCJKV1RfU0VDUkVUIiwiaXNEZXYiLCJ0b2tlbkZyb21Db29raWUiLCJyZXEiLCJjb29raWUiLCJoZWFkZXJzIiwicCIsInNwbGl0IiwiZmluZCIsImMiLCJzdGFydHNXaXRoIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiaGFuZGxlciIsInJlcyIsIm1ldGhvZCIsInNldEhlYWRlciIsInN0YXR1cyIsImpzb24iLCJtZXNzYWdlIiwidG9rZW4iLCJhdXRoIiwidmVyaWZ5IiwiZSIsImNvbnNvbGUiLCJlcnJvciIsImxvZ2luIiwicGFzc3dvcmQiLCJib2R5IiwiY2xpZW50IiwiY29ubmVjdCIsInF1ZXJ5Iiwicm93cyIsImludml0ZVJvd3MiLCJpbnZpdGUiLCJvayIsImNvbXBhcmUiLCJwYXNzd29yZF9oYXNoIiwidWNyQ29scyIsImNvbE5hbWVzIiwibWFwIiwiciIsImNvbHVtbl9uYW1lIiwiaGFzUm9sZSIsImluY2x1ZGVzIiwiaGFzSW52aXRlZEJ5IiwiaGFzSW52aXRlZEF0IiwiZXhpc3RpbmciLCJzdWIiLCJjb21wYW55X2lkIiwiY29scyIsInZhbHMiLCJwbGFjZWhvbGRlcnMiLCJpIiwicHVzaCIsInJvbGUiLCJjcmVhdGVkX2J5IiwiRGF0ZSIsInNxbCIsImpvaW4iLCJoYXNVc2VkIiwicm93Q291bnQiLCJoYXNVc2VkQnkiLCJoYXNVc2VkQXQiLCJ1cGRDb2xzIiwidXBkVmFscyIsImoiLCJsZW5ndGgiLCJpZCIsImNvbXBhbmllcyIsImpvaW5lZF9jb21wYW55X2lkIiwicmVsZWFzZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/v1/companies/join.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/../../node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fv1%2Fcompanies%2Fjoin&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fv1%2Fcompanies%2Fjoin.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();